# **Subscription API**

Сервис управления онлайн-подписками пользователей.  

## Возможности

- Создание, чтение, обновление и удаление подписок (`CRUDL`).
- Получение информации о подписке по `id`.
- Подсчет **суммарной стоимости подписок** за выбранный период с фильтрацией:
    - по `user_id` (UUID),
    - по `service_name`.

## Используемые технологии:

- PostgreSQL (в качестве хранилища данных)
- Docker (для запуска сервиса)
- Fiber (веб фреймворк)
- golang-migrate/migrate (для миграций БД)
- pgx (драйвер для работы с PostgreSQL)
- golang/mock, testify (для тестирования)

## Запуск

Запустить сервис можно с помощью команд `docker-compose up` или`make deploy`

Останавливает и удаляет развернутое окружение Docker вместе с его образами `make rollback`

Для запуска unit-тестов необходимо выполнить команду `make unit_test`

Для запуска интеграционных тестов необходимо выполнить команду `make integration_tests`

Для запуска линтера необходимо выполнить команду `make lint`

## Swagger-документация
Документация для API хранится в:
`internal/facade/rest/schema/schema.yaml`

## Примеры запросов

- [Создание подписки](#create)
- [Получить информацию о подписке](#get-info)
- [Получить список с возможностью фильтрации и пагинации](#get-list)
- [Обновление подписки](update)
- [Удаление подписке по ее id](#delete)
- [Подсчёт суммарной стоимости всех подписок за выбранный период](update)

### Создание подписки <a name="create"></a>

```curl -X POST http://localhost:8080/api/create \
-H "Content-Type: application/json" \
-d '{
  "service_name": "Yandex Plus",
  "price": 400,
  "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
  "start_date": "07-2025",
  "end_date": "12-2025"
}'
```
Пример ответа:
```
{
  "id":"fbb6e35c-91d1-4b0c-9c08-00e62aefe141"
}
```

### Получить информацию о подписке <a name="get-info"></a>
```
 curl http://localhost:8080/api/info/fbb6e35c-91d1-4b0c-9c08-00e62aefe141
```

Пример ответа:
```
{
    "id": "fbb6e35c-91d1-4b0c-9c08-00e62aefe141",
    "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
    "service_name": "Yandex Plus",
    "price": 400,
    "start_date": "07-2025",
    "end_date": "12-2025"
}
```

### Получить список с возможностью фильтрации и пагинации <a name="get-list"></a>

```
curl "http://localhost:8080/api/list?user_id=60601fee-2bf1-4721-ae6f-7636e79a0cba&from=07-2025&to=12-2025&limit=10&offset=0"
```

Пример ответа:
```
{
    "Subscriptions": [
        {
            "id": "fbb6e35c-91d1-4b0c-9c08-00e62aefe141",
            "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
            "service_name": "Yandex Plus",
            "price": 400,
            "start_date": "07-2025",
            "end_date": "12-2025"
        }
    ]
}
```

### Обновление подписки <a name="update"></a>

```
curl -X PUT http://localhost:8080/api/update/fbb6e35c-91d1-4b0c-9c08-00e62aefe141 \
-H "Content-Type: application/json" \
-d '{
  "service_name": "Yandex Plus Premium",
  "price": 450,
  "user_id": "60601fee-2bf1-4721-ae6f-7636e79a0cba",
  "start_date": "07-2025",
  "end_date": "12-2025"
}'
```

Пример ответа:
```
{
  "updated":true
}
```
### Удаление подписки по ее ID <a name="delete"></a>

```
curl -X DELETE http://localhost:8080/api/delete/fbb6e35c-91d1-4b0c-9c08-00e62aefe141
```
Пример ответа:
```
{
  "deleted":true
}
```
### Подсчёт суммарной стоимости всех подписок за выбранный период <a name="total"></a>

```
curl "http://localhost:8080/api/total?user_id=5d04611d-4c24-ab68-cf5b-69cc8902556e&from=01-2020&to=12-2026"
```

Пример ответа:
```
{
    "total": 569
}
```

### Конфигурация линтера

Конфигурация линтера настроена для тщательной проверки кода с фокусом на ошибки, неиспользуемые переменные, сложность функций и корректность типов. Включены линтеры для проверки ошибок, использования неэффективных присваиваний, а также для улучшения стиля и качества кода. Некоторые линтеры, такие как gosimple, отключены для упрощения анализа. Установлены ограничения по времени выполнения и максимальному количеству ошибок, а также исключены некоторые правила для конкретных файлов.
